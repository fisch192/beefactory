---
export const prerender = true;
import ShopLayout from '../../../layouts/ShopLayout.astro';
import ProductCard from '../../../components/ProductCard.astro';
import CartDrawer from '../../../components/cart/CartDrawer';
import { t } from '../../../lib/i18n';
import { getCollections, getCollection } from '../../../data/collections';

export async function getStaticPaths() {
  const cols = await getCollections();
  return cols.map((c) => ({ params: { handle: c.handle } }));
}

const lang = 'de';
const { handle } = Astro.params;
const result = await getCollection(handle!);
if (!result) return Astro.redirect('/de/');

const { collection, products } = result;

// Map handle to category image
const imgSlug = handle!.split('-')[0];
const catImage = `/images/cat-${imgSlug}.jpg`;
---

<ShopLayout
  lang={lang}
  title={collection.title[lang]}
  description={collection.description[lang]}
  canonicalPath={`/de/kategorien/${handle}`}
>

  <!-- Category hero banner -->
  <section class="cat-hero">
    <img src={catImage} alt={collection.title[lang]} class="cat-hero-img" />
    <div class="cat-hero-overlay"></div>
    <div class="cat-hero-body">
      <nav class="cat-breadcrumb">
        <a href="/de/">Home</a>
        <span>/</span>
        <span>{collection.title[lang]}</span>
      </nav>
      <h1 class="cat-hero-title">{collection.title[lang]}</h1>
      <p class="cat-hero-desc">{collection.description[lang]}</p>
    </div>
  </section>

  <!-- Products section -->
  <section class="cat-products">
    <div class="container-wide">
      {products.length > 0 ? (
        <div class="cat-grid">
          {products.map((product) => (
            <ProductCard product={product} lang={lang} />
          ))}
        </div>
      ) : (
        <div class="cat-empty">
          <p>Noch keine Produkte in dieser Kategorie.</p>
          <a href="/de/" class="btn-outline" style="margin-top:1.5rem;display:inline-flex">Zurück zur Übersicht</a>
        </div>
      )}
    </div>
  </section>

  <CartDrawer
    client:load
    title={t('cart.title', lang)}
    emptyText={t('cart.empty', lang)}
    totalText={t('cart.total', lang)}
    checkoutText={t('cart.checkout', lang)}
    continueText={t('cart.continue', lang)}
    removeText={t('cart.remove', lang)}
  />
</ShopLayout>

<style>
  /* ── Category hero ─────────────────────── */
  .cat-hero {
    position:    relative;
    height:      clamp(20rem, 40vw, 32rem);
    overflow:    hidden;
    display:     flex;
    align-items: flex-end;
  }
  .cat-hero-img {
    position:   absolute;
    inset:      0;
    width:      100%;
    height:     100%;
    object-fit: cover;
    filter:     brightness(0.5) saturate(0.8);
    transition: transform 0.8s cubic-bezier(0.16,1,0.3,1);
  }
  .cat-hero-overlay {
    position:   absolute;
    inset:      0;
    background: linear-gradient(
      to top,
      rgba(13,12,10,0.85) 0%,
      rgba(13,12,10,0.3)  60%,
      rgba(13,12,10,0.1)  100%
    );
  }
  .cat-hero-body {
    position:  relative;
    z-index:   2;
    width:     100%;
    padding:   0 clamp(1.25rem,5vw,4rem) clamp(2.5rem,5vw,4rem);
    max-width: 1440px;
    margin:    0 auto;
  }
  .cat-breadcrumb {
    display:        flex;
    align-items:    center;
    gap:            0.5rem;
    font-size:      0.6875rem;
    font-weight:    500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color:          rgba(255,255,255,0.4);
    margin-bottom:  1rem;
  }
  .cat-breadcrumb a {
    color:           rgba(255,255,255,0.4);
    text-decoration: none;
    transition:      color 0.2s;
  }
  .cat-breadcrumb a:hover { color: rgba(255,255,255,0.8); }
  .cat-hero-title {
    font-family:    var(--font-display);
    font-size:      clamp(2.25rem,6vw,5rem);
    font-weight:    300;
    letter-spacing: -0.025em;
    line-height:    0.95;
    color:          white;
    margin-bottom:  0.75rem;
    animation:      fadeUp 0.8s cubic-bezier(0.16,1,0.3,1) 0.05s both;
  }
  .cat-hero-desc {
    font-size:   clamp(0.875rem,1.5vw,1rem);
    font-weight: 300;
    color:       rgba(255,255,255,0.5);
    line-height: 1.65;
    max-width:   38rem;
    animation:   fadeUp 0.8s cubic-bezier(0.16,1,0.3,1) 0.18s both;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ── Products grid ─────────────────────── */
  .cat-products {
    background:     var(--color-cream);
    padding-top:    clamp(3.5rem,7vw,6rem);
    padding-bottom: clamp(4rem,8vw,8rem);
  }
  .cat-grid {
    display:               grid;
    grid-template-columns: repeat(2, 1fr);
    gap:                   1.5rem;
  }
  @media (min-width: 768px)  { .cat-grid { grid-template-columns: repeat(3, 1fr); } }
  @media (min-width: 1280px) { .cat-grid { grid-template-columns: repeat(4, 1fr); gap: 2rem; } }

  .cat-empty {
    text-align: center;
    padding:    6rem 0;
    color:      var(--color-ash);
    font-size:  1rem;
  }
</style>
