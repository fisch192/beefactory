---
import type { Product } from '../data/products';
import type { Lang } from '../lib/i18n';
import { formatPrice } from '../lib/utils';
import { t } from '../lib/i18n';

interface Props {
  product: Product;
  lang:    Lang;
}

const { product, lang } = Astro.props;
const prefix      = `/${lang}`;
const productSlug = lang === 'de' ? 'produkte' : 'prodotti';
const isBestseller = product.tags.includes('bestseller');
const isNew        = product.tags.includes('new');
---

<a href={`${prefix}/${productSlug}/${product.handle}`} class="product-card fade-in">

  <!-- Image zone -->
  <div class="product-img-wrap">
    {product.images?.[0] ? (
      <img
        src={product.images[0]}
        alt={product.title[lang]}
        class="product-img"
        loading="lazy"
      />
    ) : (
      <div class="product-placeholder">
        <!-- Decorative hex mark -->
        <svg width="52" height="60" viewBox="0 0 52 60" fill="none" class="product-hex-icon">
          <path d="M26 1L51 15V43L26 57L1 43V15L26 1Z" stroke="currentColor" stroke-width="0.8"/>
          <path d="M26 12L41 21V39L26 48L11 39V21L26 12Z" stroke="currentColor" stroke-width="0.5"/>
        </svg>
        <span class="product-placeholder-name">{product.title[lang]}</span>
      </div>
    )}

    <!-- Hover overlay -->
    <div class="product-hover-overlay"></div>

    <!-- Badges -->
    <div class="product-badges">
      {isBestseller && (
        <span class="badge badge-gold">Bestseller</span>
      )}
      {isNew && !isBestseller && (
        <span class="badge badge-dark">{lang === 'de' ? 'Neu' : 'Nuovo'}</span>
      )}
    </div>

    <!-- Quick view arrow (desktop) -->
    <div class="product-arrow">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
           stroke-linejoin="round">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    </div>
  </div>

  <!-- Info -->
  <div class="product-info">
    <div class="product-name">{product.title[lang]}</div>
    <p class="product-desc">{product.description[lang]}</p>
    <div class="product-price-row">
      <div class="product-price">
        {product.variants.length > 1 && (
          <span class="product-from">{t('product.price.from', lang)}&nbsp;</span>
        )}
        {formatPrice(product.price)}
      </div>
      {product.compareAtPrice && product.compareAtPrice > product.price && (
        <del class="product-compare">{formatPrice(product.compareAtPrice)}</del>
      )}
    </div>
  </div>

</a>

<style>
  /* ── Card shell ────────────────────────────── */
  .product-card {
    display:         block;
    text-decoration: none;
    color:           inherit;
    cursor:          pointer;
    outline-offset:  4px;
  }
  .product-card:focus-visible {
    outline: 2px solid var(--color-gold);
  }

  /* ── Image wrapper ─────────────────────────── */
  .product-img-wrap {
    position:      relative;
    aspect-ratio:  1 / 1;
    overflow:      hidden;
    background:    var(--color-warm);
    margin-bottom: 1.25rem;
    transition:    box-shadow 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .product-card:hover .product-img-wrap {
    box-shadow: 0 0 0 1px rgba(196, 154, 60, 0.2);
  }

  .product-img {
    width:        100%;
    height:       100%;
    object-fit:   cover;
    will-change:  transform;
    transition:   transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .product-card:hover .product-img {
    transform: scale(1.05);
  }

  /* ── Placeholder ───────────────────────────── */
  .product-placeholder {
    position:        absolute;
    inset:           0;
    display:         flex;
    flex-direction:  column;
    align-items:     center;
    justify-content: center;
    gap:             1rem;
    padding:         1.5rem;
    background:      linear-gradient(145deg, var(--color-warm) 0%, var(--color-warm-dark) 100%);
  }
  .product-hex-icon {
    color:    var(--color-gold-dim);
    opacity:  0.45;
    transition: opacity 0.3s;
  }
  .product-card:hover .product-hex-icon { opacity: 0.7; }

  .product-placeholder-name {
    font-size:      0.75rem;
    font-weight:    600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color:          var(--color-ash);
    text-align:     center;
    line-height:    1.4;
  }

  /* ── Hover overlay ─────────────────────────── */
  .product-hover-overlay {
    position:   absolute;
    inset:      0;
    background: rgba(13, 12, 10, 0);
    transition: background 0.35s;
    pointer-events: none;
  }
  .product-card:hover .product-hover-overlay {
    background: rgba(13, 12, 10, 0.04);
  }

  /* ── Badges ────────────────────────────────── */
  .product-badges {
    position: absolute;
    top:      0.875rem;
    left:     0.875rem;
    display:  flex;
    flex-direction: column;
    gap:      0.35rem;
  }
  .badge {
    display:        inline-block;
    font-size:      0.625rem;
    font-weight:    700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding:        0.3rem 0.6rem;
  }
  .badge-gold {
    background: var(--color-gold);
    color:      var(--color-obsidian);
  }
  .badge-dark {
    background: var(--color-obsidian);
    color:      white;
  }

  /* ── Arrow (desktop quick-view cue) ───────── */
  .product-arrow {
    position:   absolute;
    bottom:     0.875rem;
    right:      0.875rem;
    width:      2.25rem;
    height:     2.25rem;
    display:    flex;
    align-items: center;
    justify-content: center;
    background: var(--color-obsidian);
    color:      white;
    opacity:    0;
    transform:  translateY(10px);
    transition:
      opacity   0.4s cubic-bezier(0.16, 1, 0.3, 1),
      transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .product-card:hover .product-arrow {
    opacity:   1;
    transform: translateY(0);
  }

  /* ── Product info ──────────────────────────── */
  .product-info {
    padding: 0 0.125rem;
  }
  .product-name {
    font-size:      0.9375rem;
    font-weight:    550;
    letter-spacing: -0.01em;
    color:          var(--color-ink);
    line-height:    1.3;
    margin-bottom:  0.4rem;
    transition:     color 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .product-card:hover .product-name { color: var(--color-gold); }

  .product-desc {
    font-size:     0.8125rem;
    color:         var(--color-ash);
    line-height:   1.55;
    display:       -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow:      hidden;
    margin-bottom: 0.65rem;
  }

  .product-price-row {
    display:     flex;
    align-items: baseline;
    gap:         0.5rem;
  }
  .product-price {
    font-size:   0.9375rem;
    font-weight: 600;
    color:       var(--color-ink);
  }
  .product-from {
    font-size:   0.75rem;
    font-weight: 400;
    color:       var(--color-ash);
  }
  .product-compare {
    font-size:   0.8125rem;
    font-weight: 400;
    color:       var(--color-ash-light);
    text-decoration: line-through;
  }
</style>
