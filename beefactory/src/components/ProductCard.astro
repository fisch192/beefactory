---
import type { Product } from '../data/products';
import type { Lang } from '../lib/i18n';
import { formatPrice } from '../lib/utils';
import { t } from '../lib/i18n';

interface Props {
  product: Product;
  lang:    Lang;
}

const { product, lang } = Astro.props;
const prefix      = `/${lang}`;
const productSlug = lang === 'de' ? 'produkte' : 'prodotti';
const isBestseller = product.tags.includes('bestseller');
const isNew        = product.tags.includes('new');
---

<a href={`${prefix}/${productSlug}/${product.handle}`} class="product-card fade-in">

  <!-- Image zone -->
  <div class="product-img-wrap">
    {product.images?.[0] ? (
      <img
        src={product.images[0]}
        alt={product.title[lang]}
        class="product-img"
        loading="lazy"
      />
    ) : (
      <div class="product-placeholder">
        <!-- Decorative hex mark -->
        <svg width="52" height="60" viewBox="0 0 52 60" fill="none" class="product-hex-icon">
          <path d="M26 1L51 15V43L26 57L1 43V15L26 1Z" stroke="currentColor" stroke-width="0.8"/>
          <path d="M26 12L41 21V39L26 48L11 39V21L26 12Z" stroke="currentColor" stroke-width="0.5"/>
        </svg>
        <span class="product-placeholder-name">{product.title[lang]}</span>
      </div>
    )}

    <!-- Hover overlay -->
    <div class="product-hover-overlay"></div>

    <!-- Badges -->
    <div class="product-badges">
      {isBestseller && (
        <span class="badge badge-gold">Bestseller</span>
      )}
      {isNew && !isBestseller && (
        <span class="badge badge-dark">{lang === 'de' ? 'Neu' : 'Nuovo'}</span>
      )}
    </div>

    <!-- Quick view arrow (desktop) -->
    <div class="product-arrow">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
           stroke-linejoin="round">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    </div>
  </div>

  <!-- Info -->
  <div class="product-info">
    <div class="product-name">{product.title[lang]}</div>
    <p class="product-desc">{product.description[lang]}</p>
    <div class="product-price-row">
      <div class="product-price">
        {product.variants.length > 1 && (
          <span class="product-from">{t('product.price.from', lang)}&nbsp;</span>
        )}
        {formatPrice(product.price)}
      </div>
      {product.compareAtPrice && product.compareAtPrice > product.price && (
        <del class="product-compare">{formatPrice(product.compareAtPrice)}</del>
      )}
    </div>
  </div>

</a>

<style>
  /* ── Card shell ────────────────────────────── */
  .product-card {
    display:         block;
    text-decoration: none;
    color:           inherit;
    cursor:          pointer;
    outline-offset:  4px;
    padding:         1rem;
    background:      var(--color-void);
    border:          1px solid var(--color-machined);
    transition:      border-color 0.3s, transform 0.3s;
  }
  .product-card:hover {
    border-color:    var(--color-amber);
  }
  .product-card:focus-visible {
    outline: 2px solid var(--color-amber);
    outline-offset: 4px;
  }

  /* ── Image wrapper ─────────────────────────── */
  .product-img-wrap {
    position:      relative;
    aspect-ratio:  1 / 1;
    overflow:      hidden;
    background:    var(--color-machined);
    margin-bottom: 1.5rem;
  }

  .product-img {
    width:        100%;
    height:       100%;
    object-fit:   cover;
    will-change:  transform;
    transition:   transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .product-card:hover .product-img {
    transform: scale(1.05);
  }

  /* ── Placeholder ───────────────────────────── */
  .product-placeholder {
    position:        absolute;
    inset:           0;
    display:         flex;
    flex-direction:  column;
    align-items:     center;
    justify-content: center;
    gap:             1rem;
    padding:         1.5rem;
    background:      var(--color-machined);
  }
  .product-hex-icon {
    color:    var(--color-steel);
    opacity:  0.25;
    transition: opacity 0.3s, color 0.3s;
  }
  .product-card:hover .product-hex-icon { opacity: 0.7; color: var(--color-amber); }

  .product-placeholder-name {
    font-size:      0.75rem;
    font-weight:    700;
    font-family:    var(--font-sans);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color:          var(--color-steel);
    text-align:     center;
    line-height:    1.4;
  }

  /* ── Hover overlay ─────────────────────────── */
  .product-hover-overlay {
    position:   absolute;
    inset:      0;
    background: rgba(10, 10, 10, 0);
    transition: background 0.35s;
    pointer-events: none;
  }
  .product-card:hover .product-hover-overlay {
    background: rgba(10, 10, 10, 0.4);
  }

  /* ── Badges ────────────────────────────────── */
  .product-badges {
    position: absolute;
    top:      1rem;
    left:     1rem;
    display:  flex;
    flex-direction: column;
    gap:      0.5rem;
  }
  .badge {
    display:        inline-block;
    font-family:    var(--font-sans);
    font-size:      0.65rem;
    font-weight:    700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    padding:        0.4rem 0.75rem;
    border-radius:  0;
  }
  .badge-gold {
    background: var(--color-amber);
    color:      var(--color-void);
  }
  .badge-dark {
    background: var(--color-void);
    color:      var(--color-titanium);
    border:     1px solid var(--color-machined);
  }

  /* ── Arrow (desktop quick-view cue) ───────── */
  .product-arrow {
    position:   absolute;
    bottom:     1rem;
    right:      1rem;
    width:      2.5rem;
    height:     2.5rem;
    display:    flex;
    align-items: center;
    justify-content: center;
    background: var(--color-amber);
    color:      var(--color-void);
    opacity:    0;
    transform:  translateY(10px);
    transition:
      opacity   0.4s cubic-bezier(0.16, 1, 0.3, 1),
      transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .product-card:hover .product-arrow {
    opacity:   1;
    transform: translateY(0);
  }

  /* ── Product info ──────────────────────────── */
  .product-info {
    padding: 0;
  }
  .product-name {
    font-family:    var(--font-sans);
    font-size:      1rem;
    font-weight:    500;
    color:          var(--color-titanium);
    line-height:    1.4;
    margin-bottom:  0.5rem;
    transition:     color 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .product-card:hover .product-name { color: var(--color-amber); }

  .product-desc {
    font-size:     0.875rem;
    font-family:   var(--font-sans);
    color:         var(--color-steel);
    line-height:   1.6;
    display:       -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow:      hidden;
    margin-bottom: 1rem;
  }

  .product-price-row {
    display:     flex;
    align-items: baseline;
    gap:         0.75rem;
    padding-top: 1rem;
    border-top:  1px solid var(--color-machined);
  }
  .product-price {
    font-family: var(--font-sans);
    font-size:   1.125rem;
    font-weight: 700;
    color:       var(--color-amber);
  }
  .product-from {
    font-size:   0.75rem;
    font-weight: 500;
    color:       var(--color-steel);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }
  .product-compare {
    font-family: var(--font-sans);
    font-size:   0.875rem;
    font-weight: 500;
    color:       var(--color-machined);
    text-decoration: line-through;
  }
</style>
